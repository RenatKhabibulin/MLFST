# Решение проблемы с проверкой порта 8501 в Replit

## Проблема

В Replit возникает ошибка при проверке состояния приложения Streamlit:

```
❗️ The service has encountered an error while checking the health of the Streamlit app: 
Get "http://localhost:8501/healthz": dial tcp 127.0.0.1:8501: connect: connection refused
```

Replit ожидает, что приложение Streamlit будет запущено на порту 8501 (стандартный порт Streamlit), но в нашей конфигурации используется порт 5000, так как это порт, который обычно открыт в Replit для внешнего доступа.

## Решение: Прокси-сервер

Мы создали прокси-сервер, который перенаправляет запросы с порта 8501 на порт 5000. Это позволяет:

1. Сохранить нашу конфигурацию для порта 5000 (`.streamlit/config.toml`)
2. Удовлетворить ожидания Replit, который проверяет порт 8501
3. Избежать конфликтов с существующими конфигурациями для деплоя

### Файл proxy.py

```python
"""
Прокси-сервер для перенаправления запросов с порта 8501 на порт 5000.
Это решает проблему проверки Replit, который ищет Streamlit на порту 8501.
"""
import socket
import sys
from threading import Thread

def proxy_thread(src, dst):
    """Перенаправление данных между сокетами"""
    # ... (реализация)

def start_proxy(source_port, destination_port):
    """Запуск прокси-сервера для перенаправления с source_port на destination_port"""
    # ... (реализация)

if __name__ == "__main__":
    # Перенаправляем запросы с порта 8501 на 5000
    start_proxy(8501, 5000)
```

### Запуск двух процессов

Для работы решения нужно запустить два процесса:

1. **Streamlit на порту 5000:**
   ```bash
   streamlit run app.py --server.port 5000
   ```

2. **Прокси-сервер для перенаправления 8501 → 5000:**
   ```bash
   python proxy.py
   ```

### Преимущества решения

1. **Нет изменений в конфигурации Streamlit** - мы продолжаем использовать порт 5000 для основного приложения
2. **Работает с существующей документацией** - все инструкции по деплою остаются актуальными
3. **Прозрачно для пользователя** - пользователь по-прежнему взаимодействует с приложением через порт 5000
4. **Решает проблему проверки статуса в Replit** - Replit успешно проверяет здоровье приложения через порт 8501

### Настройка в Replit

В Replit можно настроить автоматический запуск обоих процессов:

1. **В файле `.replit`:**
   ```toml
   [[workflows.workflow]]
   name = "Streamlit Server"
   author = "agent"
   
   [[workflows.workflow.tasks]]
   task = "shell.exec"
   args = "streamlit run app.py --server.port 5000"
   waitForPort = 5000
   
   [[workflows.workflow]]
   name = "Proxy Server"
   author = "agent"
   
   [[workflows.workflow.tasks]]
   task = "shell.exec"
   args = "python proxy.py"
   waitForPort = 8501
   ```

2. **Или через конфигурацию интерфейса Replit:**
   - Добавить оба процесса в конфигурацию рабочих процессов
   - Убедиться, что оба процесса запускаются при старте проекта

## Альтернативные решения

1. **Изменение порта Streamlit на 8501**
   - Изменить `.streamlit/config.toml` для использования порта 8501
   - Запускать приложение напрямую на порту 8501
   - Недостаток: может конфликтовать с существующей документацией и инструкциями по деплою

2. **Настройка Replit для проверки порта 5000**
   - Изменить конфигурацию Replit для проверки порта 5000 вместо 8501
   - Недостаток: требует прямого доступа к конфигурационным файлам Replit