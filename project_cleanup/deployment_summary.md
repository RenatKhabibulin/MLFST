# Итоговый обзор проблем деплоя и их решений

В ходе подготовки проекта к деплою на Streamlit Cloud, были выявлены и решены следующие проблемы:

## 1. Проблема совместимости с Python 3.12

### Проблема
- В Python 3.12 удален модуль `distutils`, который требуется для установки некоторых пакетов
- Это влияет на совместимость с numpy==1.24.4 и другими научными библиотеками

### Решение
- Использовать Python 3.11 вместо 3.12 при деплое
- Обновить требуемые версии пакетов в `requirements-clean.txt`:
  ```
  numpy>=1.26.0       # вместо numpy==1.24.4
  pandas>=2.0.3       # более новая версия
  scipy>=1.10.1       # и т.д.
  ```
- Добавлена документация по совместимости в `project_cleanup/python312_compatibility.md`

## 2. Проблема с конфигурацией портов

### Проблема
- Streamlit Cloud ожидает, что приложение будет работать на порту 8501
- Однако в Replit обычно доступен порт 5000, порт 8501 может быть заблокирован файрволом

### Решение
- Создан файл `.streamlit/config_cloud.toml` с настройками для порта 8501
- Создан файл `.streamlit/config.toml` с настройками для порта 5000
- Создан скрипт `entry.sh` для явного указания порта запуска приложения
- Добавлен `Procfile` для указания Streamlit Cloud использовать `entry.sh`
- Созданы скрипты `prepare_for_deploy.sh` и `restore_local_config.sh` для переключения между конфигурациями

## 3. Проблема структуры проекта

### Проблема
- Сложная пакетная структура проекта создает трудности при деплое на Streamlit Cloud
- pyproject.toml и requirements.txt могут конфликтовать

### Решение
- Создан упрощенный файл `app_cloud.py` для деплоя на Streamlit Cloud
- Подготовлен файл `requirements-clean.txt` с обновленными версиями пакетов
- В `app_cloud.py` добавлено автоматическое определение среды запуска и порта
- Добавлены инструкции по деплою без использования пакетной структуры

## 4. Проблема отсутствия документации

### Решение
- Создан основной документ по деплою `README_DEPLOY.md`
- Добавлены дополнительные документы по конкретным проблемам в папке `project_cleanup/`:
  - `python312_compatibility.md` - совместимость с Python 3.12
  - `port_configuration.md` - настройка портов
  - `local_vs_cloud.md` - различия между локальным запуском и Streamlit Cloud
  - `deployment_checklist.md` - чек-лист для деплоя
  - `streamlit_cloud_deployment.md` - рекомендации по деплою

## Итоговая инструкция по деплою

1. Запустить скрипт подготовки к деплою:
   ```bash
   ./prepare_for_deploy.sh
   ```

2. Залить подготовленный код в GitHub-репозиторий

3. Создать новое приложение в Streamlit Cloud с настройками:
   - Main file path: `app_cloud.py`
   - Python version: `3.11`
   - Requirements file: `requirements-clean.txt`

4. Нажать "Deploy!" и дождаться завершения деплоя

## Инструкция по возврату к локальной разработке

1. Запустить скрипт восстановления локальной конфигурации:
   ```bash
   ./restore_local_config.sh
   ```

2. Запустить приложение локально:
   ```bash
   streamlit run app.py --server.port 5000
   ```